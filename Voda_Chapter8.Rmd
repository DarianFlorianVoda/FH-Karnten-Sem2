---
title: "Chapter 8"
author: "Darian-Florian Voda"
date: "2023-05-06"
output: 
  html_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## Data Visualization
### A practical Introduction
#### By Kieran Healy

```{r}
library(gapminder)
library(tidyverse)
library(ggplot2)
library(socviz)
library(ggrepel)
library(scales)
library(dplyr)
```

```{r}
head(asasec)
```

```{r}
p = ggplot(data = subset(asasec, Year == 2014), mapping = aes(x = Members, y = Revenues, label = Sname))

p + geom_point() + geom_smooth()
```

```{r}
p = ggplot(data = subset(asasec, Year == 2014), mapping = aes(x = Members, y = Revenues, label = Sname))

p + geom_point(mapping = aes(color = Journal)) + geom_smooth(method="lm")
```

```{r}
p0 = ggplot(data = subset(asasec, Year == 2014), mapping = aes(x = Members, y = Revenues, label = Sname))

p1 = p0 + geom_smooth(method = "lm", se = FALSE, color = "gray80") + geom_point(mapping = aes(color = Journal))

p2 = p1 + geom_text_repel(data = subset(asasec, Year == 2014 & Revenues > 7000), size = 2)
p2
```

```{r}
p3 = p2 + labs(x = "Membership", y="Revenues", color = "Section has own Journal", title = "ASA Sections",
               subtitle = "2014 Calendar year.", caption = "Source: ASA annual report.")

p4 = p3 + scale_y_continuous(labels = scales::dollar) + theme(legend.position = "bottom")

p4
```

## Question: What is Likert scale?
### A scale like from 0 to 5 or from 'not likely' to 'surely'.

```{r}
p = ggplot(data = organdata, mapping = aes(x = roads, y = donors, color = world))

p + geom_point(size = 2) + scale_color_brewer(palette = "Set2") + theme(legend.position = "top")
```

```{r}
demo('colors')
```

```{r}
# Democrat Blue and Republican Red

party_colors = c("#2E74C0", "#CB454A")

p0 = ggplot(data = subset(county_data, flipped = "No"),
            mapping = aes(x = pop, y = black/100))

p1 = p0 + geom_point(alpha = 0.15, color = "gray50") + scale_x_log10(labels = scales::comma)

p1
```

```{r}
p2 = p1 + geom_point(data = subset(county_data, flipped == "Yes"),
                     mapping = aes(x=pop, y = black/100, color = partywinner16)) +
  scale_color_manual(values = party_colors)

p2
```

```{r}
p3 = p2 + scale_y_continuous(labels=scales::percent)+
  labs(color = "County flipped to ...",
       x = "County Population (log scale)",
       y = "Percent Black Population",
       title = "Flipped counties, 2016",
       caption = "Counties in gray did not flip.")

p3

```

## Question: What does gather() do??
### Create an object that filters based on a specific key the values.

```{r}
cowplot::plot_grid(p1, p2, nrow=2, rel_heights = c(0.75, 0.25), align = "v")
```

```{r}
library(viridis)

f_labs = c(`Borrowers` = "Percent of\nall Borrowers",
           `Balances` = "Percent of\nall Balances")

p_xlab = "Amount Owed, in thousands of Dollars"
p_title = "Outstanding Student Loans"
p_subtitle = "44 million borrowers owe a total of $1.3 trillion"
p_caption = "Source: FRB NY"


p = ggplot(studebt, aes(y = pct/100, x = type, fill = Debtrc))
p + geom_bar(stat = "identity", color = "gray80") +
  scale_x_discrete(labels = as_labeller(f_labs)) + 
  scale_y_continuous(labels = scales::percent) +
  scale_fill_viridis(discrete = TRUE) +
  guides(fill = guide_legend(reverse = TRUE,
                             title.position = "top",
                             label.position = "bottom",
                             keywidth = 3,
                             nrow = 1)) +
  labs(x = NULL, y = NULL,
       fill = "Amount Owed, in thousands of dollars",
       caption = p_caption,
       title = p_title,
       subtitle = p_subtitle) +
  theme(legend.position = "top",
        axis.text.y = element_text(face = "bold", hjust = 1, size = 12),
        axis.ticks.length = unit(0, "cm"),
        panel.grid.major.y = element_blank()) +
  coord_flip()
```

## Chapter 8.6 Where to Go Next

- [GGplot2 Extensions](ggplot2-exts.org)
- [R Graph Gallery](r-graph-gallery.com)
- [R for Data Science](r4ds.had.co.nz)
- [R Programming for Data Science](https://leanpub.com/rprogramming)
- [Policy Viz](policyviz.com)